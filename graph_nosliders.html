<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Quadratic Equation</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.99.1/jsxgraphcore.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://www.dennisss.com/script/runner.js"></script>
    <script src="scripts/jstween-1.1.min.js"></script>

    <script type="application/python" name="simplify">
        def main(args):
            eqn = math(args["eqn"])
            return { "simplified": str(simplify(eqn)) }
    </script>

<script>

	var main_graph;
	var graph_elements = {};
	$(function() {graphManager();});

	function graphManager(state, graph_str, bounds) {
		state = state || "init";
		graph_str = graph_str || false;
		borderValues = [];
		bounds = bounds || false;
		
		
		if(state == "init" ) {
			var windowHeight = $(window).height();
			var windowWidth = $(window).width();
			var ww = windowWidth / -70;
			var wn = windowHeight / 70;
			var we = windowWidth / 70;
			var ws = windowHeight / -70;
			borderValues = [ww, wn, we, ws];
			
			main_graph = JXG.JSXGraph.initBoard('jxgbox',
				{
					boundingbox: borderValues,
					axis: true,
					grid: true,
					keepaspectratio: true,
					showNavigation: false,
					zoom: { wheel: true },
					pan: { enabled: true, needShift: false, needTwoFingers: false },
					showCopyright: false
				});
			var dummy = main_graph.create('point', [3,0], {visibility: "hidden"});
			dummy.hideElement();
			bounds = [50];
			state = "setBounds";
		}

        			
	}

	function draw(str, str_id) {
		var new_str = true;
		var current = 0;
		var plotted_str = {};

		eval("var funcEval =  function(x){ return (" + str + "); }");
		if(graph_elements[str_id]) {	
			main_graph.removeObject(graph_elements[str_id]);		
			graph_elements[str_id] = main_graph.create('functiongraph', [funcEval], {strokeColor:'black', strokeWidth:2});
		}
		else {	
			graph_elements[str_id] = main_graph.create('functiongraph', [funcEval], {strokeColor:'black', strokeWidth:2});
		}

	}			
</script>

    <script>
		
        function graphy(str_to_graph, str_id) {
            var str = str_to_graph || "0";
            var sympy_str = str.replace(/\^/g, "**");
            var graph_str;

			$(function() {
                $run("simplify", {
                    eqn: sympy_str
                }, function (data) {
                    if (data.error) {
						//alert(data.error);
						return;
                    }
                    graph_str = data.simplified;	                   
                    plot();					
                })
			});
			
			function sanitize_graph_str(t_str) {
				t_str = t_str.replace(/(\w)\*\*(-?\d+)/g, "Math.pow($1,$2)")				
				.replace(/(cos\(.*?\))\*\*(-?\d+)/g, "Math.pow($1, $2)")			
				.replace(/cos/g, "Math.cos")			
				.replace(/(sin\(.*?\))\*\*(-?\d+)/g, "Math.pow($1, $2)")
				.replace(/sin/g, "Math.sin")					
				.replace(/(tan\(.*?\))\*\*(-?\d+)/g, "Math.pow($1, $2)")
				.replace(/tan/g, "Math.tan")					
				.replace(/sqrt/g, "Math.sqrt");				
				return t_str;
			}
			
			function plot() {        
				var ready_str = sanitize_graph_str(graph_str);				
				draw(ready_str, str_id);
            }
        }		
		
    </script>
	
	<script>
       
        function addTextbox() {

            var n = $("#form-control > div").length;
            n += 1;
            var txtbox = $('#textbox')
			                .clone()
			                .attr({ "id": "textbox" + n})
			                .addClass('tbox')
			                .appendTo($('#form-control'));           
            $(".input-group").children("input").attr({ "id" : "eqn" + n});
        }

        $(function() {
        	$(".tbox").on('input', ".function-box", function(){
        		graphy($(this).val(), $(this).attr("id"));
        	});
        });

        

        
    	$(function () {
    		$("#clear-graph").on('click', function() {
	        	$('.tbox.form-group').remove();
	        	graphManager();
	        	
    		});
    	});
        

	
	</script>
	
</head>
<body>
    <div id="jxgbox" class="jxgbox" style="height:100vh"></div><br />
    <div class="control">
        <form role="form" class="form-inline" id="form-control">
            
			<!--<div id="txtboxes" class="form-group">
				<div id="txtbox" class="tbox input-group">
					<div class="input-group-addon">f(x)</div>
					<input id="eqn1" class="form-control function-box" type="text" placeholder="x">
				</div>
			</div>			-->
            
        </form>
        <div class="form-group">
                <div class="input-group">
                    <input type="button" id="new-txtbox" onclick="addTextbox()" class="btn btn-default" value="+" />
                    <input type="button" id="clear-graph" onclick="clearGraph()" class="btn btn-default" value="O" />
                </div>
        </div>
    </div>

    <div class="hidden-form-elements">
    	<div id="textbox" class="form-group">
				<div class="input-group">
					<div class="input-group-addon">f(x)</div>
					<input id="eqn1" class="form-control function-box" type="text" placeholder="x">
				</div>
		</div>
    </div>
    <div id="jxgsliders" class="jxgsliders" style=" width: 460px; position: absolute;"></div>
    <style>
        .control {
            position: absolute;
            top: 50px;
            left: 50px;
            background: rgba(255,255,255, 0.8);
            width: 350px;
            min-height: 150px;
            border: 1px solid #999;
            border-radius: 10px;
            padding: 20px 30px 20px;
            z-index: 1000;
            -webkit-box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
            -moz-box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
            box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
        }
        .jxgsliders {
			bottom: 50px;
            left: 50px;
            z-index: 1000;
			background: rgba(255,255,255, 0.8);
            border: 1px solid #999;
            border-radius: 10px;
            -webkit-box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
            -moz-box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
            box-shadow: 0px 0px 8px 0px rgba(100,100,100,0.75);
			visibility: hidden;
        }
		
    </style>

    <script type="application/python" name="solver">
        def main(args):
        eqn = math(args["eqn"])
        return { "solution": str(roots(eqn, multiple=True))}
    </script>

</body>
</html>
